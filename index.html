<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>雰囲気オンライン</title>
  <style>
    #output li {
      background: #ccc;
    }
  </style>
</head>

<body>
  <h1>雰囲気オンライン</h1>

  <table id="tableOutput"></table>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <script>
    //
    //フォーム動的作成
    //
    // let str = '<tr><th>番号</th><th>名前</th><th>興味</th><th>理解</th></tr>';
    // for (let i = 1; i < 21; i++) {
    //   str += '<tr>'
    //   str += '<td>' + ('000' + i).slice(-3) + '</td >'
    //   str += '<td>'
    //   str += '<label for="userName">名前</label>'
    //   str += '<input type="text" id="name_' + ('000' + i).slice(-3) + '">'
    //   str += '</td>'
    //   str += '<td>'
    //   str += '<label for="Interesting">興味</label>'
    //   str += '<input type="number" id="Interesting_' + ('000' + i).slice(-3) + '">'
    //   str += '</td>'
    //   str += '<td>'
    //   str += '<label for="understanding">理解</label>'
    //   str += '<input type="number" id="understanding_' + ('000' + i).slice(-3) + '">'
    //   str += '</td>'
    //   str += '<td>'
    //   str += '<button id="send_' + ('000' + i).slice(-3) + '" data-id=' + i + '>send</button>'
    //   str += ' </td>'
    //   str += '</tr>'
    // }
    let str = `
      <tr>
        <th>番号</th>
        <th>名前</th>
        <th>興味</th>
        <th>理解</th>
      </tr>`;
    for (let i = 1; i < 21; i++) {
      str += `
      <tr>
        <td>
          ${('000' + i).slice(-3)}
        </td>
        <td>
          <label for="userName">名前</label>
          <input type="text" id="name_${('000' + i).slice(-3)}">
        </td>
        <td>
          <label for="Interesting">興味</label>
          <input type="number" id="Interesting_${('000' + i).slice(-3)}">
        </td>
        <td>
          <label for="understanding">理解</label>
          <input type="number" id="understanding_${('000' + i).slice(-3)}">
        </td>
        <td>
          <button id="send_${('000' + i).slice(-3)}" data-id=${i}>send</button>
        </td>
      </tr>`;
    }

    $('#tableOutput').html(str);
  </script>

  <!-- 以下にfirebaseのコードを貼り付けよう -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-analytics.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBwMJsyxgknRPe8oZaYJSm3oQ6g7AHzPyo",
      authDomain: "funikionline.firebaseapp.com",
      databaseURL: "https://funikionline.firebaseio.com",
      projectId: "funikionline",
      storageBucket: "funikionline.appspot.com",
      messagingSenderId: "34885119377",
      appId: "1:34885119377:web:14f0e75412b22d697b3e30",
      measurementId: "G-2HR194MXSD"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>

  <script>
    // データベースの設定を記述
    const db = firebase.firestore().collection('funikiOnline');

    // 送信ボタンクリック時にデータを送信する処理
    $('button').on('click', function () {
      let userIDcount = Number($(this).data('id'));

      const dataObject = {
        userID: userIDcount,
        userName: $('#name_00' + userIDcount).val(),
        Interesting: Number($('#Interesting_00' + userIDcount).val()),
        understanding: Number($('#understanding_00' + userIDcount).val()),
      }
      db.doc('name_00' + userIDcount).set(dataObject);
    });


    // データをリアルタイムに取得する処理 descは大きい順ascは小さい順
    db.orderBy('userID', 'asc').onSnapshot(function (querySnapshot) {
      // まずはconsole.log()で出力してデータの形を確認！
      // console.log(querySnapshot.docs);

      querySnapshot.docs.forEach(function (doc) {
        const data = doc.data();
        console.log(data);
        $('#name_00' + data.userID).val(data.userName);
        $('#Interesting_00' + data.userID).val(data.Interesting);
        $('#understanding_00' + data.userID).val(data.understanding);

      })
    });

  </script>
</body>

</html>